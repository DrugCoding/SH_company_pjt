{% extends "base.html" %}
{% load static %}


{% block content %}
<div class="container" style="padding:10rem">
    <form action="{% url 'notices:search' %}" method="">
        {% csrf_token %}
        <div class="d-flex justify-content-end mb-3">
            <input class="form-control search-input mx-2" name="keyword" type="search" placeholder="검색어를 입력해주세요."
                aria-label="Search" style="width: 21rem; height: 3rem; font-weight: 400; ">
            <button type="search" class="btn fw-bold" style="background-color:#14402B; color:white">검색</button>
        </div>
    </form>
    <div class = "col-12">
        <table class = "table table-light">
            <thead class = "thead-light">
                <tr>
                    <th>번호</th>
                    <th>제목</th>
                    <th>작성자</th>
                    <th>작성시간</th>
                    <th>조회수</th>
                </tr>
            </thead>
            <tbody class = "text-dark">
                {% for notice in paginated_notices %}
                <tr onclick = "location.href = '{{notice.id}}'">
                    <th>{{ notice.id }}</th>
                    <th>{{ notice.title }}</th>
                    <th>{{ notice.user }}</th>
                    <th>{{ notice.created_at | date:'Y.m.d H:i'}}</th>
                    <th>{{ notice.hits }}</th>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <!-- 게시글 페이지네이션 -->
    {% if paginated_notices %}
    <ul class="pagination justify-content-center py-5">
    <!-- 첫 페이지 -->
    {% if paginated_notices.has_previous %}
    <!-- 이전페이지가 있으면 연결(첫 페이지가 아니면) -->
    <li class="page-item">
        <a class="page-link" style="color: #14402B; text-decoration: none;" tabindex="-1" href="?page=1">&#60;</a>
    </li>
    {% else %}
    <li class="page-item disabled">
        <a class="page-link" href="#">&#60;</a>
    </li>
    {% endif %}

    <!-- 페이지리스트 -->
    <!-- //페이지 범위를 하나씩 리턴 -->
    {% for page_number in paginated_notices.paginator.page_range %}
    {% if page_number >= paginated_notices.number|add:-2 and page_number <= paginated_notices.number|add:2 %} <!-- // 현재
        페이지일 때는 active -->
        {% if page_number == paginated_notices.number %}
        <li class="page-item" aria-current="page">
        <a class="page-link fw-bold" style="background-color: #14402B; color: white; text-decoration: none;"
            href="?page={{ page_number }}">{{ page_number }}</a>
        </li>
        {% else %}
        <li class="page-item text-color-warning">
        <a class="page-link fw-bold" style="color: #14402B; text-decoration: none;" href="?page={{ page_number }}">
            {{ page_number }}</a>
        </li>
        {% endif %}
        {% endif %}
        {% endfor %}

        <!-- 다음페이지 -->
        {% if paginated_notices.has_next %}
        <li class="page-item">
        <a class="page-link fw-bold" style="color: #14402B; text-decoration: none;" href="?page={{ max_index }}">&#62;</a>
        </li>
        {% else %}
        <li class="page-item disabled">
        <a class="page-link fw-bold" tabindex="-1" href="#">&#62;</a>
        </li>
        {% endif %}
    </ul>
    {% endif %}
</div>

<div id="map" style="width:100%;height:350px;">

</div>



<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=202d51da97fdb12f363699e01a90c11f&libraries=services"></script>
<script>
var mapContainer = document.getElementById('map'), // 지도를 표시할 div 
    mapOption = {
        center: new kakao.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
        level: 3 // 지도의 확대 레벨
    };  

// 지도를 생성합니다    
var map = new kakao.maps.Map(mapContainer, mapOption); 

// 주소-좌표 변환 객체를 생성합니다
var geocoder = new kakao.maps.services.Geocoder();

// 주소로 좌표를 검색합니다
geocoder.addressSearch('경기도 안성시 미양면 양변길 159', function(result, status) {

    // 정상적으로 검색이 완료됐으면 
     if (status === kakao.maps.services.Status.OK) {

        var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

        // 결과값으로 받은 위치를 마커로 표시합니다
        var marker = new kakao.maps.Marker({
            map: map,
            position: coords
        });

        // 인포윈도우로 장소에 대한 설명을 표시합니다
        var infowindow = new kakao.maps.InfoWindow({
            content: '<div class="fw-bold" style="width:9rem;text-align:center;padding:0.3rem 0;">SH건설산업(주)</div>'
        });
        infowindow.open(map, marker);

        // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
        map.setCenter(coords);
    } 
});    
</script>
{% endblock %}

